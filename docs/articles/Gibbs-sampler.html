<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="genstats">
<title>Gibbs sampler • genstats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Gibbs sampler">
<meta property="og:description" content="genstats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">genstats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Simulation.html">Simulating data</a>
    <a class="dropdown-item" href="../articles/GWAS.html">GWAS</a>
    <a class="dropdown-item" href="../articles/Gibbs-sampler.html">Gibbs sampler</a>
    <a class="dropdown-item" href="../articles/LT-FH.html">LT-FH</a>
    <a class="dropdown-item" href="../articles/Prediction.html">Prediction</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://github.com/Holdols/genstats">
    <span class="fa fa-github fa"></span>
     
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Gibbs sampler</h1>
            
      
      
      <div class="d-none name"><code>Gibbs-sampler.Rmd</code></div>
    </div>

    
    
<p>An assumption made by Hujoel et al.(2020) is that the liabilities of
subjects and families follow a multivariate normal distribution. With
this assumption liabilities of each family member can be estimated if
their phenotypes are provided.</p>
<p>These liabilitites are estimated using Monte Carlo integration. In
genstats a Gibb sampler has been implemented, by sampling from a
conditional distribution for each liability estimates are obtained
iteratively. The obtained phenotypes of family members can be
implemented in the model by sampling from a truncated normal
distribution. To clarify if a family member is a case we know that the
liability of the family member is above a threshold T, given a
prevalence K. To sample from a a truncated normal distribution we sample
a value from one of the two intervals shown below. <span class="math display">\[
T = \Phi^{-1}(1-K) \\
L_p \sim N(\mu_p, \sigma_p) \\
\Downarrow
\\
P(L_p \leq T) = F_{L_p}(T) \\
\Downarrow
\\
\text{if p is case}: p_{l_p} \in [F_{l_p}(T) , 1 ]\\
\text{else}: p_{l_p} \in [0, F_{l_p}(T)] \\
\]</span> Now we sample a value <span class="math inline">\(p_{lp}\)</span> uniformly from one of the two
intervals given the family members case. To get a sample for <span class="math inline">\(l_p\)</span> we set <span class="math inline">\(l_p = F_{L_p}^{-1}(p_{lp})\)</span>.</p>
<p>Using Monte Carlo integration we find the conditional distribution of
each liability. Using the assumption at liabilities follow a normal
distribtion where <span class="math inline">\(l_g\sim\mathcal{N}(0,h^2)\)</span>, <span class="math inline">\(l_e\sim\mathcal{N}(0,1-h^2)\)</span> and <span class="math inline">\(l_{full} = l_g+l_e \sim\mathcal{N}(0,1)\)</span>
we can write the following mean and covariance matrix for the variables.
We are here not using any siblings, but they can be added as wished.</p>
<p><span class="math display">\[
\mu =
\begin{pmatrix}
0 \\
0 \\
0 \\
0
\end{pmatrix}, \quad
\Sigma =
\begin{pmatrix}
1-h^{2} &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; h^{2} &amp; \frac{h^{2}}{2} &amp; \frac{h^{2}}{2} \\
0 &amp; \frac{h^{2}}{2} &amp; 1 &amp; 0 \\
0 &amp; \frac{h^{2}}{2} &amp; 0 &amp; 1
\end{pmatrix}
\]</span></p>
<p>Where</p>
<p><span class="math display">\[
\begin{pmatrix}
l_{c} \\
l_{g} \\
l_{p_{1}} \\
l_{p_{2}}
\end{pmatrix} \sim \mathcal{N}\left(\mu,\Sigma
\right)
\]</span></p>
<p>This we can transform into</p>
<p><span class="math display">\[
\overline{\mu} =
\begin{pmatrix}
0 \\
0 \\
0 \\
0
\end{pmatrix}, \quad
\overline{\Sigma} =
\begin{pmatrix}
h^{2} &amp; h^{2} &amp; \frac{h^{2}}{2} &amp; \frac{h^{2}}{2} \\
h^{2} &amp; 1 &amp; \frac{h^{2}}{2} &amp; \frac{h^{2}}{2} \\
\frac{h^{2}}{2} &amp; \frac{h^{2}}{2} &amp; 1 &amp; 0 \\
\frac{h^{2}}{2} &amp; \frac{h^{2}}{2} &amp; 0 &amp; 1
\end{pmatrix}
\]</span> Where</p>
<p><span class="math display">\[
\begin{pmatrix}
l_{g} \\
l_{g}+l_e \\
l_{p_{1}} \\
l_{p_{2}}
\end{pmatrix} \sim \mathcal{N}\left(\overline{\mu},\overline{\Sigma}
\right)
\]</span> Using the multivariate normal the conditional distribution for
each variable can easily be calculated. To illustrate that the simulated
data has this distrubution we will calculate the covariance matrix of
non truncated data using a heriability of 0.5 and one sibling.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://holdols.github.io/genstats" class="external-link">genstats</a></span><span class="op">)</span>

<span class="va">covariance</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_cov.html">get_cov</a></span><span class="op">(</span><span class="fl">0.5</span>, n_sib <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">estimated</span> <span class="op">=</span> <span class="fu"><a href="../reference/gibbs_sampl.html">gibbs_sampl</a></span><span class="op">(</span><span class="va">covariance</span>, phenos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, K<span class="op">=</span><span class="cn">FALSE</span>, all_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">estimated</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span>, caption <span class="op">=</span> <span class="st">"Covariance Matrix"</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Covariance Matrix</caption>
<tbody>
<tr class="odd">
<td align="right">0.48</td>
<td align="right">0.47</td>
<td align="right">0.23</td>
<td align="right">0.24</td>
<td align="right">0.23</td>
</tr>
<tr class="even">
<td align="right">0.47</td>
<td align="right">0.97</td>
<td align="right">0.23</td>
<td align="right">0.24</td>
<td align="right">0.23</td>
</tr>
<tr class="odd">
<td align="right">0.23</td>
<td align="right">0.23</td>
<td align="right">0.97</td>
<td align="right">-0.01</td>
<td align="right">0.24</td>
</tr>
<tr class="even">
<td align="right">0.24</td>
<td align="right">0.24</td>
<td align="right">-0.01</td>
<td align="right">0.97</td>
<td align="right">0.23</td>
</tr>
<tr class="odd">
<td align="right">0.23</td>
<td align="right">0.23</td>
<td align="right">0.24</td>
<td align="right">0.23</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<p>The pseudocode for the Gibbs Sampler is shown below <img src="Pseudocode.png"></p>
<p>This code is within a while loop that break when standard error of
the mean is under 0.1 to ensure convergence. With this constraint, we’ve
tried to ensure convergence. Convergence can be shown by plotting the
values for each iteration. For the plot below the configuration is
(1,1,0,1,0), where 1 refers to CASE and 0 is control, and each number
refers to the phenotype of a family member of the form <span class="math inline">\((phenotype_{subject}, phenotype_{parent1},
phenotype_{parent2}, phenotype_{sibling1},
...,phenotype_{siblingN})\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ests</span> <span class="op">=</span> <span class="fu"><a href="../reference/gibbs_sampl.html">gibbs_sampl</a></span><span class="op">(</span>covmat <span class="op">=</span> <span class="fu"><a href="../reference/get_cov.html">get_cov</a></span><span class="op">(</span><span class="fl">0.5</span>, n_sib <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, phenos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, K <span class="op">=</span> <span class="fl">0.05</span>, start_run <span class="op">=</span> <span class="fl">500</span>, all_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ests</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Genetic Liability subject"</span>,
                   <span class="st">"Liability subject, CASE"</span>,
                   <span class="st">"Liability parent1, CASE"</span>,
                   <span class="st">"Liability parent2, CONTROL"</span>,
                   <span class="st">"Liability sibling1, CASE"</span>,
                   <span class="st">"Liability sibling2, CONTROL"</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_gibbs.html">plot_gibbs</a></span><span class="op">(</span><span class="va">ests</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 methods overwritten by 'tibble':</span>
<span class="co">#&gt;   method     from  </span>
<span class="co">#&gt;   format.tbl pillar</span>
<span class="co">#&gt;   print.tbl  pillar</span></code></pre></div>
<p><img src="Gibbs-sampler_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The plots shows that all the the liabilities are converged with a
starting value of 0. And also it seems that the Gibbs sampler converges
incredibly fast. The Gibbs sampler is therefore performing as we would
expect.</p>
<p>The standard values for the genstats::gibbs_sampl is a starting value
at 0 and a burn in of 500.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Louise Mølgaard Laustsen, Ole Sahlholdt Hansen, Holdols.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
